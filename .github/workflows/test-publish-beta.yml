name: Test Publish Beta (Auto)

on:
  push:
    branches:
      - beta-release
    paths:
      - '.github/workflows/**'
      - 'scripts/**'

jobs:
  construct_version:
    runs-on: ubuntu-latest
    outputs:
      full_version: ${{ steps.version.outputs.full_version }}
    steps:
      - name: Construct full version
        id: version
        run: |
          COMMIT_SHA="9e83e4c"
          VERSION_CORE="2.0.0"
          SHORT_SHA="${COMMIT_SHA:0:8}"
          COMMIT_DATE=$(date +%Y%m%d)
          FULL_VERSION="${VERSION_CORE}-beta-${SHORT_SHA}-${COMMIT_DATE}"
          echo "full_version=${FULL_VERSION}" >> $GITHUB_OUTPUT
          echo "ðŸ“¦ Constructed version: ${FULL_VERSION}"

  publish:
    needs: construct_version
    uses: ./.github/workflows/build-and-publish.yml
    with:
      commit_sha: "9e83e4c"
      full_version: ${{ needs.construct_version.outputs.full_version }}
      npmTag: beta
    secrets:
      NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
